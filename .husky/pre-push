#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Exit immediately if a command exits with a non-zero status.
set -e

RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo "${BLUE}ğŸš€ Running pre-push checks... This may take a few minutes.${NC}"
echo ""

# 1. TypeScript Type Check
echo "ğŸ§© Checking TypeScript types..."
pnpm --filter web exec tsc --noEmit
pnpm --filter mobile exec tsc --noEmit
pnpm --filter @repo/shared exec tsc --noEmit
echo "${GREEN}âœ“ TypeScript check passed${NC}"
echo ""

# 2. Test
echo "ğŸ§ª Running full test suite..."
pnpm --filter web exec jest --coverage --passWithNoTests
echo "${GREEN}âœ“ All tests passed${NC}"
echo ""

# 3. Build
echo "ğŸ—ï¸ Building project for verification..."
pnpm --filter web exec next build
echo "${GREEN}âœ“ Build successful${NC}"
echo ""

echo "${GREEN}âœ… All pre-push checks passed. Ready to push!${NC}"